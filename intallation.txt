# ğŸš€ Kiosk System - Installation Guide

Complete setup instructions for your Mist Sanitizer Kiosk on Raspberry Pi 5.

## ğŸ“ Project Structure

```
kiosk-system/
â”œâ”€â”€ app.py                 # Main Flask application
â”œâ”€â”€ requirements.txt       # Python dependencies
â”œâ”€â”€ kiosk.db              # SQLite database (auto-created)
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ index.html        # Customer interface
â”‚   â””â”€â”€ admin.html        # Admin dashboard
â””â”€â”€ static/               # (optional for custom assets)
```

---

## ğŸ”§ Hardware Requirements

### Required Components:
1. **Raspberry Pi 5** (4GB or 8GB RAM)
2. **5-Channel Relay Module** (5V trigger, optocoupler isolated)
   - Recommended: 10A rating per channel
   - Active LOW trigger
3. **Power Supply** (5V 5A for Pi + relay power)
4. **Touchscreen Display** (7" or larger)
5. **Mist Machines** (4 units: 1 sanitizer + 3 perfume)
6. **MicroSD Card** (32GB or larger, Class 10)
7. **Jumper Wires** (Female-to-Female)

### Optional:
- Case for Raspberry Pi
- External power supply for mist machines
- Cooling fan for Pi

---

## ğŸ”Œ Wiring Diagram

### Relay Module Connection:

| Relay Channel | GPIO Pin (BCM) | Description |
|--------------|----------------|-------------|
| Channel 1    | GPIO 17        | Sanitizer Mist |
| Channel 2    | GPIO 27        | Perfume A |
| Channel 3    | GPIO 22        | Perfume B |
| Channel 4    | GPIO 23        | Perfume C |
| Channel 5    | GPIO 24        | Reserved |

### Relay to Raspberry Pi:
```
Relay Module          Raspberry Pi 5
VCC       â”€â”€â”€â”€â”€â”€â”€â”€â†’   5V (Pin 2)
GND       â”€â”€â”€â”€â”€â”€â”€â”€â†’   GND (Pin 6)
IN1       â”€â”€â”€â”€â”€â”€â”€â”€â†’   GPIO 17 (Pin 11)
IN2       â”€â”€â”€â”€â”€â”€â”€â”€â†’   GPIO 27 (Pin 13)
IN3       â”€â”€â”€â”€â”€â”€â”€â”€â†’   GPIO 22 (Pin 15)
IN4       â”€â”€â”€â”€â”€â”€â”€â”€â†’   GPIO 23 (Pin 16)
IN5       â”€â”€â”€â”€â”€â”€â”€â”€â†’   GPIO 24 (Pin 18)
```

### Relay to Mist Machines:
```
Each relay switches the power to mist machines:
- Common (COM) â†’ Connect to power source positive
- Normally Open (NO) â†’ Connect to mist machine positive
- Mist machine negative â†’ Connect to power source negative
```

---

## ğŸ’» Software Installation

### Step 1: Update Raspberry Pi OS

```bash
sudo apt update && sudo apt upgrade -y
```

### Step 2: Install Required System Packages

```bash
sudo apt install -y python3-pip python3-venv git
```

### Step 3: Create Project Directory

```bash
mkdir ~/kiosk-system
cd ~/kiosk-system
```

### Step 4: Create Python Virtual Environment

```bash
python3 -m venv venv
source venv/bin/activate
```

### Step 5: Install Python Dependencies

Create `requirements.txt`:
```bash
cat > requirements.txt << EOF
Flask==3.0.0
Flask-CORS==4.0.0
RPi.GPIO==0.7.1
requests==2.31.0
EOF
```

Install dependencies:
```bash
pip install -r requirements.txt
```

### Step 6: Create Project Files

**Create templates directory:**
```bash
mkdir templates
```

**Copy the HTML files** (index.html and admin.html) into the `templates/` folder.

**Copy app.py** to the main directory.

### Step 7: Configure Solana Wallet

Edit the database settings:
```bash
sqlite3 kiosk.db
```

Update your Solana wallet address:
```sql
UPDATE settings SET value='YOUR_ACTUAL_SOLANA_WALLET_ADDRESS' WHERE key='solana_wallet';
.quit
```

Or do it from the Python console:
```python
python3
>>> import sqlite3
>>> conn = sqlite3.connect('kiosk.db')
>>> c = conn.cursor()
>>> c.execute("UPDATE settings SET value='YOUR_WALLET_HERE' WHERE key='solana_wallet'")
>>> conn.commit()
>>> conn.close()
>>> exit()
```

---

## ğŸš€ Running the Application

### Manual Start:

```bash
cd ~/kiosk-system
source venv/bin/activate
python3 app.py
```

Access the kiosk:
- **Customer Interface:** http://raspberrypi.local:5000
- **Admin Dashboard:** http://raspberrypi.local:5000/admin

### Auto-Start on Boot:

Create systemd service:
```bash
sudo nano /etc/systemd/system/kiosk.service
```

Add this content:
```ini
[Unit]
Description=Mist Sanitizer Kiosk
After=network.target

[Service]
Type=simple
User=pi
WorkingDirectory=/home/pi/kiosk-system
Environment="PATH=/home/pi/kiosk-system/venv/bin"
ExecStart=/home/pi/kiosk-system/venv/bin/python3 /home/pi/kiosk-system/app.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

Enable and start service:
```bash
sudo systemctl daemon-reload
sudo systemctl enable kiosk.service
sudo systemctl start kiosk.service
```

Check status:
```bash
sudo systemctl status kiosk.service
```

---

## ğŸ–¥ï¸ Kiosk Mode Setup (Fullscreen Browser)

### Install Chromium Browser:
```bash
sudo apt install -y chromium-browser unclutter xdotool
```

### Auto-start in Kiosk Mode:

Edit autostart:
```bash
mkdir -p ~/.config/lxsession/LXDE-pi
nano ~/.config/lxsession/LXDE-pi/autostart
```

Add these lines:
```
@xset s off
@xset -dpms
@xset s noblank
@unclutter -idle 0
@chromium-browser --kiosk --noerrdialogs --disable-infobars --disable-session-crashed-bubble http://localhost:5000
```

Reboot to test:
```bash
sudo reboot
```

---

## ğŸ” Default Credentials

**Admin Login:**
- Username: (not required)
- Password: `admin123`

**Change Password:**
```bash
sqlite3 kiosk.db
UPDATE settings SET value='YOUR_NEW_PASSWORD' WHERE key='admin_password';
.quit
```

---

## ğŸ§ª Testing Without Hardware

For testing on laptop/desktop (no GPIO):

1. Comment out GPIO imports in `app.py`:
```python
# import RPi.GPIO as GPIO
```

2. Comment out `init_gpio()` call in main:
```python
if __name__ == '__main__':
    # init_gpio()  # Comment this line
    init_db()
    # ... rest of code
```

3. Run normally:
```bash
python3 app.py
```

---

## ğŸ“Š Database Schema

### Transactions Table:
```sql
CREATE TABLE transactions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    product_id INTEGER,
    product_name TEXT,
    price REAL,
    sol_amount REAL,
    sol_rate REAL,
    payment_method TEXT,
    status TEXT,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### Settings Table:
```sql
CREATE TABLE settings (
    key TEXT PRIMARY KEY,
    value TEXT
);
```

**Default Settings:**
- `price_sanitizer`: 30
- `price_perfume`: 35
- `admin_password`: admin123
- `solana_wallet`: YOUR_SOLANA_WALLET_ADDRESS_HERE

---

## ğŸŒ Network Access

### Local Network Access:

Find your Pi's IP:
```bash
hostname -I
```

Access from other devices:
- Customer: `http://192.168.x.x:5000`
- Admin: `http://192.168.x.x:5000/admin`

### Remote Access (Optional):

Use ngrok for remote access:
```bash
# Install ngrok
curl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc >/dev/null
echo "deb https://ngrok-agent.s3.amazonaws.com buster main" | sudo tee /etc/apt/sources.list.d/ngrok.list
sudo apt update && sudo apt install ngrok

# Start tunnel
ngrok http 5000
```

---

## ğŸ› ï¸ Troubleshooting

### Relay Not Working:
```bash
# Test GPIO manually
python3
>>> import RPi.GPIO as GPIO
>>> GPIO.setmode(GPIO.BCM)
>>> GPIO.setup(17, GPIO.OUT)
>>> GPIO.output(17, GPIO.LOW)  # Should activate relay
>>> GPIO.output(17, GPIO.HIGH)  # Should deactivate
>>> GPIO.cleanup()
```

### Check Service Logs:
```bash
sudo journalctl -u kiosk.service -f
```

### Permission Issues:
```bash
sudo usermod -a -G gpio pi
sudo reboot
```

### Database Issues:
```bash
# Reset database
rm kiosk.db
python3 app.py  # Will recreate database
```

---

## ğŸ“± Features

âœ… **Customer Interface:**
- Product selection with prices
- Solana Pay QR code generation
- Real-time PHP to SOL conversion
- Payment confirmation

âœ… **Admin Dashboard:**
- Login authentication
- Sales statistics
- Transaction history
- Price management (remote)
- Manual relay testing
- Usage analytics

âœ… **Backend Features:**
- SQLite database
- GPIO relay control
- Multi-threaded relay activation
- Auto SOL rate updates
- Session management

---

## ğŸ”„ Updates & Maintenance

### Update Application:
```bash
cd ~/kiosk-system
git pull  # If using git
sudo systemctl restart kiosk.service
```

### Backup Database:
```bash
cp kiosk.db kiosk_backup_$(date +%Y%m%d).db
```

### View Logs:
```bash
tail -f /var/log/syslog | grep kiosk
```

---

## ğŸ’¡ Tips

1. **Test relays individually** before connecting mist machines
2. **Use proper power supplies** - separate for Pi and mist machines
3. **Add a kill switch** for emergency stops
4. **Monitor temperature** - add cooling if needed
5. **Regular backups** of the database
6. **Update SOL wallet address** before going live

---

## ğŸ†˜ Support

For issues or questions:
1. Check the troubleshooting section
2. Review system logs
3. Test components individually
4. Verify all connections

---

## ğŸ“ License

This project is provided as-is for educational and commercial use.

---

**Ready to Launch! ğŸš€**

Your kiosk system is now complete and ready for deployment!
